<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8"/>
  <title>Title</title>
  <script src="https://demo.yubico.com/js/u2f-api.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"/>
  <script>
    var username;
    function getChallenge() {
      console.log('Getting challenge');
       username = $('#username').val();
      $.ajax({
        url: '/yubi/register/' + username,
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          $('#msg').html("Klik op uw yubikey");
          $('#form').hide();
          register(data);
        }
      });
    }

    function sendRegistration(data) {
      $.ajax({
        contentType: "application/json",
        url: '/yubi/register/' + username,
        type: 'POST',
        dataType:'json',
        data: data,
        success: function() {
          $('#msg').html('Uw yubikey is geregistreerd. Klik <a href="login">login</a>');
        }
      })
    }

    function register(challenge) {
      console.log(challenge);
      var request = challenge;
      setTimeout(function () {
        u2f.register(request.registerRequests, request.authenticateRequests,
                function (data) {
                  if (data.errorCode) {
                    alert("U2F failed with error: " + data.errorCode);
                    return;
                  }
                var data2 = JSON.stringify(data);
                  console.log(data2);
                  sendRegistration(data2)
                });
      }, 1000);
    }
  </script>

  <!--<script>-->
  <!--var challenge =-->
  <!--u2f.sign([challenge], [],-->
  <!--function(deviceResponse) {-->
  <!--document.getElementById('response-input').value = JSON.stringify(deviceResponse)-->
  <!--document.getElementById('login-form').submit() 2-->
  <!--}-->
  <!--);-->
  <!--</script>-->
</head>
<body>
<div id="form">
  Geef uw gebruikersnaam op: <input type="text" name="username" id="username"/>
  <button value="Klik" onclick="getChallenge()">Klik</button>
</div>
<div id="msg"></div>


</body>
</html>



